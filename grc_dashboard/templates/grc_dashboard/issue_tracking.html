{% extends 'grc_dashboard/base.html' %}

{% block title %}PO&AMs - ICARIS{% endblock %}

{% block nav_poams %}active{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1>Plans of Action & Milestones</h1>
        <p class="subtitle">Track and manage security action items and remediation tasks.</p>
    </div>
    <a href="#" class="btn-primary-custom">
        <i class="fas fa-plus"></i>Add PO&AM
    </a>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon critical">
            <i class="fas fa-exclamation-circle"></i>
        </div>
        <div class="stat-value">{{ issues.count }}</div>
        <div class="stat-label">Total PO&AMs</div>
    </div>

    <div class="stat-card">
        <div class="stat-icon pending">
            <i class="fas fa-clock"></i>
        </div>
        <div class="stat-value">{{ issues|length }}</div>
        <div class="stat-label">Open Items</div>
    </div>

    <div class="stat-card">
        <div class="stat-icon resolved">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-value">0</div>
        <div class="stat-label">Resolved</div>
    </div>

    <div class="stat-card">
        <div class="stat-icon overdue">
            <i class="fas fa-calendar-times"></i>
        </div>
        <div class="stat-value">0</div>
        <div class="stat-label">Overdue</div>
    </div>
</div>

<!-- Filters -->
<div class="filter-card">
    <div class="filter-title">Filter PO&AMs</div>
    <form method="get" class="row g-3">
        <div class="col-md-3">
            <label class="form-label">Priority Level</label>
            <select name="priority" class="form-select">
                <option value="">All Priorities</option>
                <option value="critical" {% if priority_filter == 'critical' %}selected{% endif %}>Critical</option>
                <option value="high" {% if priority_filter == 'high' %}selected{% endif %}>High</option>
                <option value="medium" {% if priority_filter == 'medium' %}selected{% endif %}>Medium</option>
                <option value="low" {% if priority_filter == 'low' %}selected{% endif %}>Low</option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Status</label>
            <select name="status" class="form-select">
                <option value="">All Statuses</option>
                <option value="open" {% if status_filter == 'open' %}selected{% endif %}>Open</option>
                <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>In Progress</option>
                <option value="resolved" {% if status_filter == 'resolved' %}selected{% endif %}>Resolved</option>
                <option value="closed" {% if status_filter == 'closed' %}selected{% endif %}>Closed</option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Department</label>
            <select name="department" class="form-select">
                <option value="">All Departments</option>
            </select>
        </div>
        <div class="col-md-3 d-flex align-items-end gap-2">
            <button type="submit" class="btn-filter flex-grow-1">
                <i class="fas fa-filter me-2"></i>Apply Filters
            </button>
            <a href="{% url 'issue_tracking' %}" class="btn-clear">
                <i class="fas fa-times"></i>
            </a>
        </div>
    </form>
</div>

<!-- PO&AMs Table -->
<div class="table-card">
    <div class="table-header">
        <div>
            <div class="table-title">All PO&AMs</div>
            <div class="table-subtitle">{{ issues.count }} item{{ issues.count|pluralize }} found</div>
        </div>
    </div>
    <table class="custom-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Department</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Assigned To</th>
                <th>Due Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for issue in issues %}
            <tr>
                <td><strong>#{{ issue.id }}</strong></td>
                <td>{{ issue.title }}</td>
                <td>{{ issue.department.name }}</td>
                <td>
                    <span class="priority-badge {{ issue.priority }}">
                        {{ issue.get_priority_display }}
                    </span>
                </td>
                <td>
                    <span class="status-badge {{ issue.status }}">
                        {{ issue.get_status_display }}
                    </span>
                </td>
                <td>{{ issue.assigned_to.get_full_name|default:issue.assigned_to.username|default:"Unassigned" }}</td>
                <td>{{ issue.due_date|default:"No deadline" }}</td>
                <td>
                    <div class="d-flex gap-2">
                        <a href="#" class="btn-action">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="#" class="btn-action delete">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No PO&AMs found. Create your first action item to get started.</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}